C51 COMPILER V9.60.0.0   MOTOR_DC                                                          12/07/2024 17:48:00 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MOTOR_DC
OBJECT MODULE PLACED IN motor_dc.OBJ
COMPILER INVOKED BY: C:\Program Files\C51\BIN\C51.EXE motor_dc.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg51.h>
   2          #include<intrins.h>
   3          
   4          // 定义计时相关的宏
   5          #define TICK_TIME_US_1000 1000  // 每个tick的时间为1000微秒
   6          #define TICK_PER_SEC_1000 1000  // 每秒的tick数为1000
   7          #define TIMER_1_PRESET_VALUE TICK_TIME_US_1000  // 定时器1的预设值
   8          
   9          // 定义电机控制引脚
  10          sbit motor_IN1 = P1^0;  // 电机输入1
  11          sbit motor_IN2 = P1^1;  // 电机输入2
  12          sbit motor_EN = P1^2;   // 电机使能引脚
  13          
  14          // 外部变量声明
  15          extern float present_temp;   // 当前温度
  16          extern float target_temp;   // 目标温度
  17          extern unsigned char duty_cycle;  // 占空比
  18          
  19          // 初始化定时器1用于PWM控制
  20          void init_timer1_pwm()
  21          {
  22   1          TMOD |= 0x10;  // 设置定时器1为模式1
  23   1          TH1 = (65536 - TIMER_1_PRESET_VALUE) / 256;  // 设置定时器高8位
  24   1          TL1 = (65536 - TIMER_1_PRESET_VALUE) % 256;  // 设置定时器低8位
  25   1          TR1 = 1;  // 启动定时器1
  26   1          ET1 = 1;  // 使能定时器1中断
  27   1          EA = 1;   // 全局中断使能
  28   1      }
  29          
  30          // 定时器1中断服务程序
  31          void time1ISR() interrupt 3
  32          {
  33   1          static unsigned int counter = 0;  // 计数器用于PWM周期控制
  34   1          
  35   1          counter++;  // 计数器递增
  36   1          if (counter >= 100)  // 达到100则重置
  37   1          {
  38   2              counter = 0;
  39   2          }
  40   1          if (counter < duty_cycle)  // 根据占空比控制电机
  41   1          {
  42   2              motor_IN1 = 1;  // 设置电机方向
  43   2              motor_IN2 = 0;
  44   2              motor_EN = 1;   // 使能电机
  45   2          }
  46   1          else
  47   1          {
  48   2              motor_EN = 0;  // 禁能电机
  49   2          }
  50   1          
  51   1          TH1 = (65536 - TIMER_1_PRESET_VALUE) / 256;  // 重新加载定时器值
  52   1          TL1 = (65536 - TIMER_1_PRESET_VALUE) % 256;
  53   1      }
  54          
  55          // 电机控制函数
C51 COMPILER V9.60.0.0   MOTOR_DC                                                          12/07/2024 17:48:00 PAGE 2   

  56          void motor_control()
  57          {
  58   1          if (present_temp <= target_temp)  // 当前温度低于或等于目标温度
  59   1          {
  60   2              duty_cycle = 0;  // 停止电机
  61   2              return;
  62   2          }
  63   1          else  // 当前温度高于目标温度
  64   1          {
  65   2              duty_cycle = present_temp*10 - target_temp*10 + 20;  // 计算占空比
  66   2              if (duty_cycle > 100) duty_cycle = 100;  // 占空比上限为100
  67   2              else if (duty_cycle < 0) duty_cycle = 0;  // 占空比下限为0
  68   2          }
  69   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    198    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
